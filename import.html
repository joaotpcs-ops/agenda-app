<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Importar Tarefas</title>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<style>
body{font-family:Arial;padding:20px;background:#0f0f0f;color:#fff;}
button{padding:10px 20px;font-size:14px;cursor:pointer;margin:10px 0;}
#log{background:#1a1a1a;padding:10px;border-radius:5px;margin-top:20px;max-height:400px;overflow-y:auto;font-size:12px;font-family:monospace;}
</style>
</head>
<body>
<h1>Importar Tarefas para Agenda</h1>
<p>Este script vai adicionar 40 tarefas ao Firebase.</p>
<button onclick="startImport()">IMPORTAR TAREFAS</button>
<div id="log"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC_YOvjmHn2_zwuq7OB_nAnKfSLQ2uMPK0",
  authDomain: "agenda---joao.firebaseapp.com",
  projectId: "agenda---joao",
  storageBucket: "agenda---joao.firebasestorage.app",
  messagingSenderId: "269409095295",
  appId: "1:269409095295:web:b39ee70de9e3ba1523394a"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const tarefas = [
  ["2026-05-11","ANUAL","FAMÍLIA","DATAS","ANINHAS CORREIA DA SILVA SILVEIRA MONTENEGRO - BAPTISMO - 2024"],
  ["2026-05-11","ANUAL","FAMÍLIA","DATAS","TOMÁS TOSCANO - CARTA CONDUÇÃO - 2011"],
  ["2026-05-12","ANUAL","FAMÍLIA","DATAS","TIAGO CABRAL ADÃO DA FONSECA - NASCIMENTO - 2018"],
  ["2026-05-12","ANUAL","FAMÍLIA","DATAS","FERNANDINHO TOSCANO - NASCIMENTO - ?"],
  ["2026-05-12","ANUAL","FAMÍLIA","DATAS","TIAGO CABRAL ADÃO DA FONSECA - BAPTISMO - 2024"],
  ["2026-05-12","ANUAL","FAMÍLIA","DATAS","ZÉ MIGUEL FONSECA GERMANO - 1ª COMUNHÃO - 2024"],
  ["2026-05-13","ANUAL","FAMÍLIA","DATAS","ZÉ MARIA CORREIA DA SILVA MONTENEGRO - NASCIMENTO - 2013"],
  ["2026-05-14","ANUAL","AMIGOS","DATAS","MANEL PIMENTEL PESTANA - BAPTISMO - 2011"],
  ["2026-05-15","ANUAL","AMIGOS","DATAS","DAVID MELO - NASCIMENTO - 1983"],
  ["2026-05-15","ANUAL","FAMÍLIA","DATAS","DIAS DA FAMÍLIA - DIA DA FAMÍLIA"],
  ["2026-05-15","ANUAL","FAMÍLIA","DATAS","INESINHA ADÃO DA FONSECA JANSON - BAPTISMO - 2022"],
  ["2026-05-16","ANUAL","FAMÍLIA","DATAS","AVÓ CRISTINA - NASCIMENTO - 1925"],
  ["2026-05-17","ANUAL","AMIGOS","DATAS","MATILDE VILLAS-BOAS SARMENTO - BAPTISMO - 2014"],
  ["2026-05-18","ANUAL","AMIGOS","DATAS","ALEX SARMENTO E RITA - CASAMENTO - 2019"],
  ["2026-05-22","ANUAL","FAMÍLIA","DATAS","INÊS FONSECA - NASCIMENTO - 1977"],
  ["2026-05-24","ANUAL","FAMÍLIA","DATAS","MAFALDA PEREIRA LEITE E BERNARDO - CASAMENTO - 2025"],
  ["2026-05-24","ANUAL","FAMÍLIA","DATAS","KIKA TOSCANO CRUZ - NASCIMENTO - 1990"],
  ["2026-05-25","ANUAL","FAMÍLIA","DATAS","PEDRO TOSCANO E TERESA CASTRO VIANA - CASAMENTO - 2019"],
  ["2026-05-28","ANUAL","FAMÍLIA","DATAS","TIA RAQUEL - NASCIMENTO - 1955"],
  ["2026-05-29","ANUAL","AMIGOS","DATAS","GASPAR CANTISTA RIBEIRO - NASCIMENTO - 2020"],
  ["2026-05-30","ANUAL","AMIGOS","DATAS","JOANA NOVAES E MARTIM PITTA NEGRÃO - CASAMENTO - 2009"],
  ["2026-06-01","ANUAL","AMIGOS","DATAS","MANEL NAZARETH XAVIER - NASCIMENTO - 2019"],
  ["2026-06-01","ANUAL","FAMÍLIA","DATAS","DIAS DA FAMÍLIA - DIA DA CRIANÇA"],
  ["2026-06-03","ANUAL","FAMÍLIA","DATAS","AVÔ PETÉ - NASCIMENTO - 1928"],
  ["2026-06-03","ANUAL","FAMÍLIA","DATAS","TERESINHA TOSCANO PINHEIRO - NASCIMENTO - 2002"],
  ["2026-06-04","ANUAL","FAMÍLIA","DATAS","LUÍS GODINHO E PAULINE - CASAMENTO - 2022"],
  ["2026-06-06","ANUAL","FAMÍLIA","DATAS","TOMÁS TOSCANO E CATARINA CORTE REAL - PEDIDO CASAMENTO - (2020)"],
  ["2026-06-10","ANUAL","AMIGOS","DATAS","LENINHA TRIGUEIRINHO E MANEL - CASAMENTO - 2022"],
  ["2026-06-10","ANUAL","FAMÍLIA","DATAS","SOFIA FONSECA E FILIPE GERMANO - CASAMENTO - 2009"],
  ["2026-06-10","ANUAL","FAMÍLIA","DATAS","KIKA FONSECA GERMANO - 1ª COMUNHÃO - 2021"],
  ["2026-06-10","ANUAL","FAMÍLIA","DATAS","LUÍS FONSECA GERMANO - 1ª COMUNHÃO - 2021"],
  ["2026-06-11","ANUAL","AMIGOS","DATAS","JOANA NOVAES - NASCIMENTO - ?"],
  ["2026-06-11","ANUAL","FAMÍLIA","DATAS","AVÓ NACAS - NASCIMENTO - 1931"],
  ["2026-06-15","ANUAL","FAMÍLIA","DATAS","AVÓ QUIM - NASCIMENTO - 1930"],
  ["2026-06-15","ANUAL","FAMÍLIA","DATAS","LUISINHA CASTRO VIANA FONSECA DA CRUZ - NASCIMENTO - 2021"],
  ["2026-06-16","ANUAL","AMIGOS","DATAS","MÃE LUÍS FERREIRA (FEIO) - MORTE - 2025"],
  ["2026-06-16","ANUAL","AMIGOS","DATAS","LUÍS XOCH E MAFALDA VILELA - CASAMENTO - 2018"],
  ["2026-06-17","ANUAL","FAMÍLIA","DATAS","AVÓ FERNANDO - MORTE - 1989"],
  ["2026-06-18","ANUAL","AMIGOS","DATAS","CRISTINA VILLAS-BOAS E HUGO - CASAMENTO - ?"],
  ["2026-06-19","ANUAL","AMIGOS","DATAS","ANTÓNIO AFAÍDE TOMÉ RIBEIRO - BAPTISMO - 2016"]
];

// Convert YYYY-MM-DD to internal format (keeps as YYYY-MM-DD internally)
function parseDate(str){
  return str; // Internal storage is YYYY-MM-DD
}

function log(msg){
  document.getElementById('log').innerHTML += msg + '<br>';
}

async function startImport(){
  log('Iniciando autenticação...');
  
  try {
    const user = await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    log('✓ Autenticado como: ' + user.user.email);
    
    log('Carregando dados atuais...');
    const docRef = db.collection('users').doc(user.user.uid).collection('data').doc('main');
    const snap = await docRef.get();
    
    let tasks = [];
    let agendas = ['PESSOAL'];
    let subj = {'PESSOAL': {'FAMÍLIA': [], 'AMIGOS': []}};
    
    if(snap.exists){
      const data = snap.data();
      tasks = data.tasks || [];
      agendas = data.agendas || ['PESSOAL'];
      subj = data.subj || {'PESSOAL': {}};
    }
    
    // Garantir que FAMÍLIA e AMIGOS existem como assuntos
    if(!subj['PESSOAL']) subj['PESSOAL'] = {};
    if(!subj['PESSOAL']['FAMÍLIA']) subj['PESSOAL']['FAMÍLIA'] = [];
    if(!subj['PESSOAL']['AMIGOS']) subj['PESSOAL']['AMIGOS'] = [];
    
    // Garantir que DATAS existe como sub-assunto
    if(!subj['PESSOAL']['FAMÍLIA'].includes('DATAS')) subj['PESSOAL']['FAMÍLIA'].push('DATAS');
    if(!subj['PESSOAL']['AMIGOS'].includes('DATAS')) subj['PESSOAL']['AMIGOS'].push('DATAS');
    
    log('Convertendo ' + tarefas.length + ' tarefas...');
    
    let recMap = {
      'ANUAL': 'yearly',
      'MENSAL': 'monthly',
      'SEMANAL': 'weekly',
      'DIÁRIA': 'daily',
      'TRIMESTRAL': 'quarterly',
      'SEMESTRAL': 'semiannual'
    };
    
    tarefas.forEach((t, i) => {
      tasks.push({
        id: Date.now().toString() + '_' + i,
        agenda: 'PESSOAL',
        color: '#2196f3', // Azul
        date: parseDate(t[0]), // YYYY-MM-DD format
        subject: t[2], // FAMÍLIA ou AMIGOS
        subSubject: t[3], // DATAS
        recurrence: {type: recMap[t[1]] || 'none'},
        description: t[4],
        notes: '',
        emails: [],
        seriesId: null
      });
    });
    
    log('Salvando no Firebase...');
    await docRef.set({
      tasks: tasks,
      agendas: agendas,
      subj: subj,
      trash: [],
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    log('✓ CONCLUÍDO! ' + tarefas.length + ' tarefas importadas.');
    log('Podes fechar esta janela e ir para a agenda.');
    
  } catch(err) {
    log('✗ ERRO: ' + err.message);
    console.error(err);
  }
}
</script>
</body>
</html>
